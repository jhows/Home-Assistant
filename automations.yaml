 
  #notify when internet comes down
  - alias: 'Notify internet offline'
    trigger:
      - platform: state
        entity_id: sensor.speedtest_ping
        to: unknown
    action: 
      - service: notify.ios_thaless_iphone_7
        data:
          message: "Internet connection offline. Now we are offline :("
  #notify when internet comes back
  - alias: 'Notify internet comes back'
    trigger:
      - platform: state
        entity_id: sensor.speedtest_ping
        from: unknown
    action: 
      - service: notify.ios_thaless_iphone_7
        data:
          message: "Internet connection are back. Now we are online :D"
  # Turn vacation mode on automatically
  - alias: 'thales vacation mode on when gone 24 hours'
    trigger:
      - platform: state
        entity_id: device_tracker.thaless_iphone_7
        from: 'home'
        to: 'not_home'
        for:
          hours: 24
          minutes: 0
          seconds: 0
    action:
      - service: homeassistant.turn_on
        entity_id: input_boolean.vacation_mode

  # Turn vacation mode off automatically
  - alias: 'thales vacation mode off when home'
    trigger:
      - platform: state
        entity_id: device_tracker.thaless_iphone_7 
        from: 'not_home'
        to: 'home'
    action:
      - service: homeassistant.turn_off
        entity_id: input_boolean.vacation_mode

  # Turn on lights when vacation mode active
  - alias: 'stat-vac_Vacation lights at sunset when vacation mode on'
    trigger:
      - platform: state
        entity_id: sun.sun
        from: 'above_horizon'
        to: 'below_horizon'
    condition:
      - condition: state
        entity_id: input_boolean.vacation_mode
        state: 'on'
    action:
      - service: script.vacation_lights
  # Home status
  - alias: "not home status from device tracker"
    trigger:
      - platform: state
        entity_id: device_tracker.thaless_iphone_7
        from: 'not_home'
        to: "home"
        for:
          minutes: 3
    action:
      - service: input_select.select_option
        data:
          entity_id: input_select.thales_status
          option: "At Home"

  # Away status
  - alias: "Set away status from device tracker"
    trigger:
      - platform: state
        entity_id: device_tracker.thaless_iphone_7
        from: 'home'
        to: "not_home"
        for:
          minutes: 10
    action:
      - service: input_select.select_option
        data:
          entity_id: input_select.thales_status
          option: "Away"

  - alias: "Media player paused/stopped"
    trigger:
      - platform: state
        entity_id: media_player.kodi
        from: 'playing'
        to: 'idle'
    condition:
      - condition: state
        entity_id: sun.sun
        state: 'below_horizon'
    action:
        - service: scene.turn_on
          entity_id: scene.livingroom_normal
        - service: script.tweet_engine
          data_template:
            tweet: >
              {{ [
              "Parece que o filme acabou, já que está escuro é hora de aumentar o brilho das luzes!",
              "Irei agora aumentar o brilho das luzes, já que o filme acabou e a TV foi desligada."
              ] | random + " #movietime"}}
  #light on media player start/stop
  - alias: "Media player playing"
    trigger:
      - platform: state
        entity_id: media_player.kodi
        to: 'playing'
        from: 'idle'
    condition:
      - condition: state
        entity_id: sun.sun
        state: 'below_horizon'
    action:
        - service: scene.turn_on
          entity_id: scene.livingroom_dim
        - service: script.tweet_engine
          data_template:
            tweet: >
              {{ [
              "Minha família começou a assistir a um filme, irei fechar as persianas e diminuir o brilho das luzes!",
              "Irei agora abaixar o brilho das luzes e fechar as persianas, pois minha família está indo assistir a um filme na TV."
              ] | random + " #movietime"}}
  - alias: Notify Of New External IP
    initial_state: 'on'
    trigger:
      platform: state
      entity_id: sensor.external_ip
    condition:
      - condition: template
        value_template: "{% if trigger.from_state and trigger.to_state %} True {% else %} False {% endif %}"
    action:
      - service: notify.ios_thaless_iphone_7
        data:
          message: "Your External IP changed from {{ trigger.from_state.state }} to {{ trigger.to_state.state }}"
      - service: script.tweet_engine
        data_template:
          tweet: >
            {{ [
            "Parece que meu endereço de IP mudou. @souzaathales, por favor cheque isto.",
            "Hora de atualizar as coisas @souzaathales. Parece que meu endereço de IP mudou."
            ] | random + " #HomeAutomation"}}
  - alias: 'drink water reminder hourly'
    trigger:
      - platform: time
        at: '07:00:00'
      - platform: time
        at: '08:00:00'
      - platform: time
        at: '09:00:00'
      - platform: time
        at: '10:00:00'
      - platform: time
        at: '11:00:00'
      - platform: time
        at: '13:00:00'
      - platform: time
        at: '14:00:00'
      - platform: time
        at: '15:00:00'
      - platform: time
        at: '16:00:00'
      - platform: time
        at: '17:00:00'
      - platform: time
        at: '18:00:00'
      - platform: time
        at: '19:00:00'
      - platform: time
        at: '20:00:00'
      - platform: time
        at: '22:00:00'
    condition:
      condition: and
      conditions:
        - condition: state
          entity_id: input_boolean.drink_water
          state: 'on'
    action:
      - service: homeassistant.turn_on
        entity_id: input_boolean.drinkwatersave
      - delay: 00:00:05
      - service: script.drink_water_hourly
      - delay: 00:01:00
      - service: homeassistant.turn_off
        entity_id: input_boolean.drinkwatersave
  - alias: 'pc restart'
    trigger:
      platform: state
      entity_id: input_select.pcoptions
      to: "Restart"
    action:
      - service: shell_command.restart_pc
  - alias: 'pc shutdown'
    trigger:
      platform: state
      entity_id: input_select.pcoptions
      to: "Shutdown"
    action:
      - service: shell_command.shutdown_pc
  - alias: 'pc lock'
    trigger:
      platform: state
      entity_id: input_select.pcoptions
      to: "Lock"
    action:
      - service: shell_command.lock_pc
  - alias: 'pc sleep'
    trigger:
      platform: state
      entity_id: input_select.pcoptions
      to: "Sleep"
    action:
      - service: shell_command.sleep_pc   
  #record video when motion is detected at bedroom
  - alias: "Bedroom video recorder motion"
    trigger:
      - platform: numeric_state
        entity_id: sensor.ip_webcam_motion
        above: 900
    action:
      - service: script.turn_recorder_on
      - delay: 0:5
      - service: script.turn_recorder_off

  #battery alert
  - alias: "Wall tablet batery alert"
    trigger:
      - platform: numeric_state
        entity_id: sensor.ip_webcam_battery_level
        below: '20'
    action:
      - service: tts.google_say
        entity_id: media_player.bedroom_wall
        data:
          message: 'Low battery on bedroom wall tablet!'
      - service: notify.ios_thaless_iphone_7
        data:
          title: "Alert!"
          message: "Low battery on bedroom wall tablet!"
  #study switch
  - alias: 'study time on'
    trigger:
      platform: state
      entity_id: input_boolean.study_time
      from: 'off'
      to: 'on'
    action:
      service: script.study_time
  - alias: 'study time off'
    trigger:
      platform: state
      entity_id: input_boolean.study_time
      from: 'on'
      to: 'off'
    action:
      - service: media_player.media_stop
        data_template:
          entity_id: media_player.bedroom_wall
  #radio
  - alias: 'Set Radio Volume'
    trigger:
      platform: state
      entity_id: input_number.volume_radio
    action:
      service: media_player.volume_set
      data_template:
        entity_id: >
          {% if is_state("input_select.chromecast_radio", "Bedroom") %} media_player.kodi
          {% elif is_state("input_select.chromecast_radio", "Livingroom") %} media_player.kodi
          {% endif %}
        volume_level: '{{  states.input_number.volume_radio.state  }}'
  #arm alarm at night if ha restart
  - alias: 'Arm alarm if restart'
    initial_state: 'on'
    trigger:
     - platform: homeassistant
       event: start
    condition:
      condition: and
      conditions:
        - condition: state
          entity_id: group.home_devices
          state: home
        - condition: sun
          after: sunset
        - condition: sun
          before: sunrise
    action:
      service: alarm_control_panel.alarm_arm_home
      data:
        entity_id: alarm_control_panel.home_alarm
        code: !secret alarmcode
  #arm alarm at night
  - alias: 'Arm alarm at night'
    trigger:
      platform: time
      at: "22:00:00"
    condition:
      condition: state
      entity_id: group.home_devices
      state: home
    action:
      service: alarm_control_panel.alarm_arm_home
      data:
        entity_id: alarm_control_panel.home_alarm
        code: !secret alarmcode
  #disarm at morning
  - alias: 'Disarm alarm in the morning'
    trigger:
      platform: time
      at: "07:00:00"
    condition:
      condition: state
      entity_id: group.home_devices
      state: home
    action:
      service: alarm_control_panel.alarm_disarm
      data:
        entity_id: alarm_control_panel.home_alarm
        code: !secret alarmcode
  #motion test
  - alias: "bedroom alarm"
    trigger:
      - platform: state
        entity_id: light.ceiling_light
        from: 'off'
        to: 'on'
    condition:
      condition: and
      conditions:
        - condition: state
          entity_id: alarm_control_panel.home_alarm
          state: 'armed_away'
    action:
      - service: script.alarm_light
      - service: notify.ios_thaless_iphone_7
        data:
          title: "Alert!"
          message: "Motion detected in Bedroom"
  #alarm home
  - alias: 'Send notification when alarm tunned on Home'
    trigger:
      - platform: state
        entity_id: alarm_control_panel.home_alarm
        to: 'armed_home'
    action:
      - service: notify.ios_thaless_iphone_7
        data:
          message: "The house alarm has been switched on in home mode. Goodnight"
          data:
            attachment:
              content-type: jpeg
            push:
              category: camera
            entity_id: camera.frontdoor_camera
      - service: notify.html5
        data_template:
          message: "The house alarm has been switched on in home mode. Goodnight."
        data:
          data:
            tag: 'notification-about-alarm'
            image: !secret html5cameraimage
            url: !secret html5cameraurl
      - service: media_player.volume_set
        data:
          entity_id: media_player.bedroom_wall
          volume_level: 1.00
      - service: tts.google_say
        entity_id: media_player.bedroom_wall
        data:
          message: 'The house alarm has been switched on in home mode. Goodnight'
      - service: script.turn_on
        data:
          entity_id: script.light_notify
  #alarm away
  - alias: 'Send notification when alarm tunned on Away'
    trigger:
      - platform: state
        entity_id: alarm_control_panel.home_alarm
        to: 'armed_away'
    action:
      - service: notify.ios_thaless_iphone_7
        data:
          message: "The house alarm has been switched on in away mode. Goodbye"
          data:
            data:
            attachment:
              content-type: jpeg
            push:
              category: camera
            entity_id: camera.frontdoor_camera
      - service: tts.google_say
        entity_id: media_player.bedroom_wall
        data:
          message: 'The house alarm has been switched on in away mode. Goodbye'
  #alarm off
  - alias: 'Send notification when alarm tunned off'
    trigger:
      - platform: state
        entity_id: alarm_control_panel.home_alarm
        to: 'disarmed'
    action:
      - service: notify.ios_thaless_iphone_7
        data:
          message: "The house alarm has been Deactivated"
          data:
            push:
              badge: 0
      - service: tts.google_say
        entity_id: media_player.bedroom_wall
        data:
          message: 'The house alarm has been Deactivated'
      - service: script.turn_on
        data:
          entity_id: script.alarm_off
  #arming alarm notification
  - alias: 'Alarm Away Mode Arming'
    trigger:
      - platform: state
        entity_id: alarm_control_panel.home_alarm
        to: 'pending'
    action:
      - service: notify.ios_thaless_iphone_7
        data:
          message: "House alarm activating, ensure all doors and windows are closed"
      - service: tts.google_say
        entity_id: media_player.bedroom_wall
        data:
          message: 'House alarm activating, ensure all doors and windows are closed'
  #timelaps
  - alias: Dayli timelapse
    trigger:
      platform: time
      at: '21:00:00'
    action:
      - service: notify.ios_thaless_iphone_7
        data:
          message: 'Daily timelapse reminder!'
  #test game notification
  - alias: Notification when someone start GTA V
    trigger:
      platform: template
      value_template: "{{ is_state_attr('sensor.steam_76561198261582146', 'game', 'Grand Theft Auto V') }}"
    action:
      - service: notify.ios_thaless_iphone_7
        data:
          message: 'Thalles is playing GTA V'
  #turn morning summary on at 6
  - alias: Turn Morning summary boolean on at 6am mon-fri
    trigger:
      platform: time
      at: '06:00:00'
    condition:
        condition: state
        entity_id: device_tracker.thaless_iphone_7
        state: 'home'
    action:
      service: homeassistant.turn_on
      entity_id: input_boolean.good_morning_summary
    #morning summary
  - alias: Speak the weather and morning commute time
    trigger:
      - platform: state
        entity_id: light.ceiling_light
        from: 'off'
        to: 'on'
    condition:
      condition: and
      conditions:
        - condition: state
          entity_id: device_tracker.thaless_iphone_7
          state: 'home'
        - condition: state
          entity_id: input_boolean.good_morning_summary
          state: 'on'
    action:
     # - service: notify.wall_tablet
      #  data_template:
       #   message: >
        #    Good morning, Thalles. The time is now(). It is currently {{states('sensor.dark_sky_temperature')}} degrees outside. Today's weather is {{states('sensor.dark_sky_summary')}}. There will be a high of {{states('sensor.dark_sky_daily_high_temperature')}} and a low of {{states('sensor.dark_sky_daily_low_temperature')}}. If you left now, it would take approximately {{states('sensor.home_to_school')}} minutes to get to school.
      - service: tts.google_say
        entity_id: media_player.bedroom_wall
        data_template:
          message: >
            Good morning, Thalles. The time is {{states('sensor.time')}}. It is currently {{states('sensor.dark_sky_temperature')}} degrees outside. Today's weather is {{states('sensor.dark_sky_summary')}}. There will be a high of {{states('sensor.dark_sky_daily_high_temperature')}} and a low of {{states('sensor.dark_sky_daily_low_temperature')}}. If you left now, it would take approximately {{states('sensor.home_to_school')}} minutes to get to school.
      - service: homeassistant.turn_off
        entity_id: input_boolean.good_morning_summary
  #Turn xmas tree on and off
  - alias: xmas tree on
    hide_entity: false
    trigger:
      - platform: sun
        event: sunrise
      - platform: sun
        event: sunset
        offset: "-00:15:00"
    condition:
      condition: template
      value_template: '{{ now().month == 12 }}'
    action:
      - service: script.xmas_on
      - service: notify.ios_thaless_iphone_7
        data:
          message: 'Christmas Tree lights are turned on.'
  #turn off
  - alias: xmas tree off
    hide_entity: false
    trigger:
      - platform: time
        at: '09:00:00'
      - platform: time
        at: '23:30:00'
    condition:
      condition: template
      value_template: '{{ now().month == 12 }}'
    action:
      - service: script.xmas_off
      - service: notify.ios_thaless_iphone_7
        data:
          message: 'Christmas Tree lights are turned off.'
  #Rain Alert
  - alias: 'Rain Radar Alert'
    initial_state: 'on'
    trigger:
      platform: numeric_state
      entity_id: sensor.dark_sky_nearest_storm_distance
      below: 6
    condition:
      condition: or
      conditions:
        - condition: state
          entity_id: 'device_tracker.thaless_iphone_7'
          state: 'not_home'
    action:
      - service: script.turn_on
        data:
          entity_id: script.rain_radar_push
  #notification when my pc turn off 
  - alias: Pc notifications off
    trigger:
      - platform: state
        entity_id: switch.thalles_pc
        from: 'on'
        to: 'off'
    action:
      - service: script.turn_on
        data:
          entity_id: script.pc_off_push
  #notification when my pc turn on
  - alias: Pc notifications on
    trigger:
      - platform: state
        entity_id: switch.thalles_pc
        from: 'off'
        to: 'on'
    action:
      - service: script.turn_on
        data:
          entity_id: script.pc_on_push
  #notification about new hass version
  - alias: Update notifications
    trigger:
      - platform: state
        entity_id: updater.updater
    action:
      - service: notify.ios_thaless_iphone_7
        data:
          message: "Home Assistant {{ states('updater.updater') }} is available."
      - service: script.tweet_engine
        data:
          tweet: "Nova versão do @Home_Assistant! Espero que o @souzaathales insale logo! - {{ states('updater.updater') }}"

  #restart notify
  - alias: Notify of Home Assistant restart
    trigger:
      - platform: homeassistant
        event: start
    action:
      - service: notify.ios_thaless_iphone_7
        data:
          message: "Home Assistant has restarted"
      - service: notify.html5
        data_template:
          message: "Home Assistant has restarted"
        data:
          data:
            tag: 'notification-about-restart'
      - delay: 00:01:00
      - service: homeassistant.turn_on
        entity_id: input_boolean.drink_water
  #clear tts clache
  - alias: Flush TTS Cache
    trigger:
      platform: time
      at: '2:35:00'
    action:
      - service: tts.clear_cache
      - service: notify.ios_thaless_iphone_7
        data:
          message: "TTS cache cleared."
      - service: script.tweet_engine
        data:
          tweet: "São 2:35, isso significa que devo limpar o cache de TTS para estar tudo pronto quando amanhecer :)"
  #dark theme at night
  - alias: 'Set dark theme for the night'
    initial_state: True
    trigger:
      - platform: sun
        event: sunset
    condition:
      condition: state
      entity_id: input_boolean.dark_theme_status
      state: 'on'
    action:
      - service: frontend.set_theme
        data:
          name: midnight
  #normal theme at day
  - alias: 'Set normal theme for day'
    initial_state: True
    trigger:
      - platform: sun
        event: sunrise
    condition:
      condition: state
      entity_id: input_boolean.dark_theme_status
      state: 'on'
    action:
      - service: frontend.set_theme
        data:
          name: mydefault
  #set theme
  - alias: 'Set theme at startup'
    initial_state: 'on'
    trigger:
     - platform: homeassistant
       event: start
    action:
      service: frontend.set_theme
      data:
        name: mydefault

  - alias: "Turn on lights on sunset"
    initial_state: True
    trigger:
       platform: sun
       event: sunset
       offset: "-00:10:00"
    condition:
      condition: state
      entity_id: group.home_devices
      state: home
    action:
      - service: light.turn_on
        entity_id: light.ceiling_light
        data:
          brightness: 140
          transition: 10
      - service: script.tweet_engine
        data_template:
          tweet: >
            {{ [
            "Agora são {{states.sensor.time.state}} e está ficando escuro. Estou ligando as luzes para minha família. Eu sou tão legal!",
            "É hora de aumentar o brilho das luzes e fechar as persianas para minha família. São {{states.sensor.time.state}} e está ficando escuro.",
            "Já são {{states.sensor.time.state}} e está ficando escuro. Estou ligando as luzes e fechando as persianas para minha família."
            ] | random + " #Goodnight"}}
  - alias: 'Send notification when sun rises and turn lights off'
    initial_state: True
    trigger:
      platform: sun
      event: sunrise
      offset: "00:30:00"
    action:
      - service: script.goodmorning_informations

      - service: notify.ios_thaless_iphone_7
        data:
          message: 'All lights are turned off.'
          title: 'The sun is up.'

      - service: light.turn_off
        entity_id: group.all_lights

      - service: script.tweet_engine
        data_template:
          tweet: >
            {{ [
            "O sol está nascendo, é hora de desligar as luzes externas.",
            "É hora desligar as luzes externas, o sol está nascendo!"
            ] | random + " #GoodMorning"}}

  - alias: 'Send notification when sun sets'
    initial_state: True
    trigger:
      platform: sun
      event: sunset
      offset: '+00:00:00'
    action:
      service: notify.ios_thaless_iphone_7
      data:
        message: 'The sun is down.'
        data:
          push:
            sound: "US-EN-Alexa-Good-Night.wav"

  - alias: 'send notification when Thalles is on home'
    initial_state: True
    trigger:
      platform: state
      entity_id: device_tracker.thaless_iphone_7
      from: 'not_home'
      to: 'home'
    action:
      - service: notify.ios_thaless_iphone_7
        data:
          message: 'Dear Thalles, welcome home'
          title: "Home Assistant"
          data:
            push:
              sound: "US-EN-Alexa-Welcome-Home.wav"
  - alias: 'send notification when Thalles left home'
    initial_state: True
    trigger:
      platform: state
      entity_id: device_tracker.thaless_iphone_7
      from: 'home'
      to: 'not_home'
    action:
      - service: notify.ios_thaless_iphone_7
        data:
          message: 'Bye, have a great time!'
          title: "Home Assistant"

  - alias: 'light on gradually with alarm'
    initial_state: True
    hide_entity: False
    trigger:
      platform: template
      value_template: '{{ states.sensor.time.state == states.sensor.alarm_clock_time_long.state }}'
    condition:
      condition: and
      conditions:
        - condition: time
          weekday:
            - mon
            - tue
            - wed
            - thu
            - fri
        - condition: state
          entity_id: input_boolean.alarm_clock_status
          state: 'on'
    action:
      - service: script.wake_up

      - service: notify.ios_thaless_iphone_7
        data:
          message: 'Time to Wake Up!'
          title: "Good morning Thalles."
          data:
            push:
              sound: "goodmorningalarm.wav"